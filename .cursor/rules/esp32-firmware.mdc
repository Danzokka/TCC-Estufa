---
globs: apps/esp/**/*.cpp,apps/esp/**/*.h,apps/esp/**/*.ino
description: Regras para desenvolvimento do firmware ESP32
---

# Firmware ESP32 - TCC-Estufa

## Estrutura do Hardware

### 🔌 Sensores Implementados

- **TH_SENSOR** - Temperatura e Umidade ambiente (DHT22)
- **SOIL_SENSOR** - Umidade do solo
- **FLOW_SENSOR** - Sensor de vazão para irrigação
- **OLED** - Display para informações locais

### 🎛️ Atuadores

- **PUMP** - Bomba de irrigação
- **QR_CONFIG** - Configuração via QR Code

### 📡 Comunicação

- **SERVER** - Comunicação HTTP com a API
- **Wi-Fi** - Conexão de rede

## Estrutura de Código

### 📁 Organização

- **src/main.cpp** - Arquivo principal
- **lib/** - Bibliotecas customizadas para cada componente
- **include/** - Headers compartilhados
- **platformio.ini** - Configuração do PlatformIO

### 🔧 Padrões de Desenvolvimento

- Use PlatformIO para desenvolvimento
- Mantenha bibliotecas separadas por funcionalidade
- Implemente tratamento de erro robusto
- Use configuração via QR Code para facilitar setup
- Mantenha logs detalhados para debugging

### 🌐 Comunicação com API

- Envio de dados dos sensores via HTTP POST
- Recebimento de comandos de controle
- Implementação de heartbeat para status
- Reconexão automática em caso de falha

### 🧪 Testes

- Guia de teste da bomba: [apps/esp/pump-test-guide.md](mdc:apps/esp/pump-test-guide.md)
- Script de teste Python: [apps/esp/test_pump.py](mdc:apps/esp/test_pump.py)
